<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 4A Web Report</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        code {
            background-color: #f4f4f4;
            padding: 2px 4px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Project 4A Web Report</h1>

    <h2>Shoot and digitize pictures</h2>
    <p>For this project, I took several pictures, mostly of my dormitory. When taking these photos, I make sure to take them in a well-lit environment, and to take photos from different angles and perspectives. I also made sure to use the exposure to ensure lighting is consistent. Each pair of photos are of the same scene but from different perspectives projections.</p>
    <p>Notice how they all have decent detail in them that dictates straight lines!</p>

    <table>
        <tr>
            <th></th>
            <th>Projection 1</th>
            <th>Projection 2</th>
        </tr>
        <tr>
            <td>Image Set A: International House Courtyard</td>
            <td><img src="image.png" alt="International House Courtyard Projection 1"></td>
            <td><img src="image-1.png" alt="International House Courtyard Projection 2"></td>
        </tr>
        <tr>
            <td>Image Set B: portrait closet and front door of my dorm</td>
            <td><img src="image-2.png" alt="Dorm closet and front door Projection 1"></td>
            <td><img src="image-3.png" alt="Dorm closet and front door Projection 2"></td>
        </tr>
        <tr>
            <td>Image Set C: landscape shelf to door of my dorm</td>
            <td><img src="image-4.png" alt="Dorm shelf to door Projection 1"></td>
            <td><img src="image-5.png" alt="Dorm shelf to door Projection 2"></td>
        </tr>
    </table>

    <h2>Recover Homographies</h2>
    <p>For each of the pairs of images, I recovered the transformation between the two images. To do so, I started with correspondences manually. Here are the correspondences I used for Image Set A:</p>

    <table>
        <tr>
            <th>Image 1</th>
            <th>Image 2</th>
        </tr>
        <tr>
            <td><img src="image-6.png" alt="Image 1 correspondences"></td>
            <td><img src="image-7.png" alt="Image 2 correspondences"></td>
        </tr>
    </table>

    <p>It is important for the order of the correspondences to be consistent. I then computed the homography using the following math. What we want is a homography that maps points from the first image to the second image. This consists of a 3x3 matrix H such that $p_2 = H p_1$ where $p_1$ and $p_2$ are points in the first and second image, respectively. To get H, we first get the corresponding points in the two images, then set a matrix equation of the form Ah=b where h is a vector holding the 8 unknown entries of H:</p>

    <p>
        $$
        A = -1 * \begin{bmatrix}
        -x_1 & -y_1 & -1 & 0 & 0 & 0 & x_1 x_2 & y_1 x_2 \\
        0 & 0 & 0 & -x_1 & -y_1 & -1 & x_1 y_2 & y_1 y_2
        \end{bmatrix}
        $$
    </p>

    <p>
        $$
        h = \begin{bmatrix}
        h_{11} \\ h_{12} \\ h_{13} \\ h_{21} \\ h_{22} \\ h_{23} \\ h_{31} \\ h_{32}
        \end{bmatrix}
        $$
    </p>

    <p>
        $$
        b = \begin{bmatrix}
        x_2 \\ y_2
        \end{bmatrix}
        $$
    </p>

    <p>We get $A$ from the following mathematical derivation:</p>

    <p>
        $$
        \begin{bmatrix}
        x_2 \\ y_2
        \end{bmatrix} = H \begin{bmatrix}
        x_1 \\ y_1 \\ 1
        \end{bmatrix} = \begin{bmatrix}
        h_{11} & h_{12} & h_{13} \\
        h_{21} & h_{22} & h_{23} \\
        h_{31} & h_{32} & h_{33}
        \end{bmatrix} \begin{bmatrix}
        x_1 \\ y_1 \\ 1
        \end{bmatrix}
        $$
    </p>

    <p>
        $$
        \begin{bmatrix}
        x_2 \\ y_2
        \end{bmatrix} = \begin{bmatrix}
        h_{11} x_1 + h_{12} y_1 + h_{13} \\
        h_{21} x_1 + h_{22} y_1 + h_{23} \\
        h_{31} x_1 + h_{32} y_1 + h_{33}
        \end{bmatrix}
        $$
    </p>

    <p>, where $h_{33} = 1$ because we are working in homogeneous coordinates.</p>
    <img src="image-23.png" alt="Mask for Image Set A">

    <h2>Warp Images</h2>
    <p>Deliverable: warped images for each set.</p>
    <p>Once we get the homography, we can apply the homography such that the two images are in the same projection. What I do is apply the homography to Image 1.</p>
    <p>But there's some complexity to it. I first had to create a new image of the new size based on a bounding box I compute (and also allowed as manual input). Then I get the coordinates of the new image and apply the inverse homography to get the coordinates of the original image. I then interpolate the pixel values of the original image to get the pixel values of the new image.</p>
    <p>This is what the warped images of Image 1 of each set look like:</p>

    <table>
        <tr>
            <th>Warped Image 1 of Set A</th>
            <th>Warped Image 1 of Set B</th>
            <th>Warped Image 1 of Set C</th>
        </tr>
        <tr>
            <td><img src="image-11.png" alt="Warped Image 1 of Set A"></td>
            <td><img src="image-9.png" alt="Warped Image 1 of Set B"></td>
            <td><img src="image-10.png" alt="Warped Image 1 of Set C"></td>
        </tr>
    </table>

    <h2>Image Rectification</h2>
    <p>I also confirmed that the homographies I computed are correct by rectifying images that I know have rectangles.</p>
    <p>Consider the following 2 sets of images:</p>
    <p>Here I take my laptop</p>
    <img src="image-12.png" alt="Laptop original">
    <p>and then apply a transform of the TRACKPAD to get the rectangle in following image:</p>
    <img src="image-13.png" alt="Laptop transformed">
    <p>I then get the homography between the two images and warp the images to get the following rectified images:</p>
    <img src="image-14.png" alt="Laptop rectified">
    <p>Look at how the trackpad is now a rectangle! Furthermore, the keyboard is now a rectangle as well and the keys are more clear. Like magic!</p>
    <p>Here is another example.</p>
    <img src="image-15.png" alt="Door original">
    <p>I then apply a transform to get the rectangle in the following image that peeks into the door. You can see the door is now a rectangle:</p>
    <img src="image-16.png" alt="Door rectified">

    <h2>Blending Images Into a Mosaic</h2>
    <p>For each set of images, I apply a mask to the warped images to blend them together. I used Laplacian pyramids of each image to blend them together.</p>
    <p>To start off, I align the images after the warping and then blend them together with techniques in project 3. Here are the results!</p>

    <table>
        <tr>
            <th></th>
            <th>warped aligned 1</th>
            <th>warped aligned 2</th>
            <th>Mask</th>
            <th>Blended Image</th>
        </tr>
        <tr>
            <td>Image Set A</td>
            <td><img src="image-24.png" alt="Warped Image 1 of Set A"></td>
            <td><img src="image-25.png" alt="Warped Image 2 of Set A"></td>
            <td><img src="image-17.png" alt="Mask for Image Set A" width="200" height="auto"></td>
            <td><img src="image-18.png" alt="Blended Image for Set A"></td>
        </tr>
        <tr>
            <td>Image Set B</td>
            <td><img src="image-26.png" alt="Warped Image 1 of Set B"></td>
            <td><img src="image-27.png" alt="Warped Image 2 of Set B"></td>
            <td><img width="200" height="auto" src="image-19.png" alt="Mask for Image Set B"></td>
            <td><img src="image-20.png" alt="Blended Image for Set B"></td>
        </tr>
        <tr>
            <td>Image Set C</td>
            <td><img src="image-28.png" alt="Warped Image 1 of Set C"></td>
            <td><img src="image-29.png" alt="Warped Image 2 of Set C"></td>
            <td><img  width="200" height="auto" src="image-21.png" alt="Mask for Image Set C"></td>
            <td><img src="image-22.png" alt="Blended Image for Set C"></td>
        </tr>
    </table>
</body>
</html>